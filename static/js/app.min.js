var winner_e="",winner_n="",winner_s1="",winner_s2="",winner_s3="",winner_s4="",winner_s5="",winner_value=0,winner_svalue=0,obfuscate=0,white_rabbit=0,comeUndone="",recalc_litmus=!0,halp="1"==getURLParameter("halp");function updateRecalc(){1==$("#recalc_on").prop("checked")?($("#btnrecalcon").removeClass("btn-secondary").addClass("btn-primary"),$("#btnrecalcoff").removeClass("btn-primary").addClass("btn-secondary"),recalc_litmus=!0):($("#btnrecalcoff").removeClass("btn-secondary").addClass("btn-primary"),$("#btnrecalcon").removeClass("btn-primary").addClass("btn-secondary"),recalc_litmus=!1)}function getURLParameter(e){for(var a=window.location.search.substring(1).split("&"),t=0;t<a.length;t++){var l=a[t].split("=");if(l[0]==e)return l[1]}}function toggleDark(){$("body").removeClass("bg-dark text-light"),$(".sticky-top").removeClass("bg-dark"),$(".card").removeClass("bg-dark"),$(".nav-link").removeClass("text-light"),$("table").removeClass("table-dark"),1==$("#wolf").prop("checked")?($("body").addClass("bg-dark text-light"),$(".sticky-top").addClass("bg-dark"),$(".card").addClass("bg-dark"),$(".nav-link").addClass("text-light"),$("table").addClass("table-dark"),$("#btnwolf").removeClass("btn-dark text-secondary").addClass("btn-danger"),$("#btnlamb").removeClass("btn-info").addClass("btn-light text-secondary")):($("#btnlamb").removeClass("btn-light text-secondary").addClass("btn-info"),$("#btnwolf").removeClass("btn-danger").addClass("btn-dark text-secondary")),storeData()}function toggleSplash(e){1==$("#wet").prop("checked")?($("#btnwet").removeClass("btn-dark text-secondary").addClass("btn-info"),$("#btndry").removeClass("btn-info").addClass("btn-dark text-secondary")):($("#btndry").removeClass("btn-dark text-secondary").addClass("btn-info"),$("#btnwet").removeClass("btn-info").addClass("btn-dark text-secondary")),0!=e&&adjustWeights()}function generateArtifacts(){$("#accept2").hide(),$("#artifacts").empty(),$("#daltifacts").empty(),$.each(artifacts.data,function(e,a){isNaN(a.level)&&(a.level=0);var t='<tr class="'+(1==a.active?"":"text-dark bg-secondary")+'" id="'+e+'row">';t+="<td>",t+='<input type="checkbox" aria-label="Checkbox to designate active status for '+a.name+'" id="'+e+'active"'+(1==a.active?' checked="checked"':"")+" onchange=\"updateActive('"+e+'\');" tabindex="-1">',t+="</td>",t+="<td>",t+='<label for="'+e+'active" id="basic-addon'+e+'">',t+='<span class="d-block d-sm-none">'+a.name+"</span>",t+='<span class="d-none d-sm-block">'+a.name+"</span>",t+="</label>",t+="</td>",t+="<td>",t+='<input id="'+e+'" value="'+a.level+'" type="tel" class="form-control artlvl" placeholder="0" aria-label="Level of '+a.name+'" aria-describedby="basic-addon'+e+'"onchange="updateArtifact(\''+e+"')\">",t+="</td>",t+="<td>",t+='<span class="badge" id="'+e+'expo"></span>',t+="</td>",t+="<td>",t+='<button class="badge badge-secondary" type="button" data-toggle="collapse" data-target="#'+e+'info" aria-expanded="false" aria-controls="'+e+'info" tabindex="-1">&#x00A0;i&#x00A0;</button>',t+="</td>",t+="</tr>",t+='<tr class="collapse" id="'+e+'info">',t+='<td colspan="5">',t+='<dl class="row">',t+='<dt class="col-3 col-sm-6 text-right">Name</dt>',t+='<dd class="col-9 col-sm-6">'+a.name+"</dd>",t+='<dt class="col-3 col-sm-6 text-right">Effect</dt>',t+='<dd class="col-9 col-sm-6" id="'+e+'effect"></dd>',t+='<dt class="col-3 col-sm-6 text-right">',t+='<span class="d-block d-sm-none">AD</span>',t+='<span class="d-none d-sm-block">Artifact Damage</span>',t+="</dt>",t+='<dd class="col-9 col-sm-6" id="'+e+'ad"></dd>',t+='<dt class="col-3 col-sm-6 text-right">',t+='<span class="d-block d-sm-none">Cost</span>',t+='<span class="d-none d-sm-block">Cost to Upgrade</span>',t+="</dt>",t+='<dd class="col-9 col-sm-6" id="'+e+'cost"></dd>',t+='<dt class="col-3 col-sm-6 text-right">',t+='<span class="d-block d-sm-none">Effc.</span>',t+='<span class="d-none d-sm-block">Efficiency</span>',t+="</dt>",t+='<dd class="col-9 col-sm-6" id="'+e+'eff"></dd>',t+="</dl>",t+="</td>",t+="</tr>",$("#artifacts").append(t);var l='<div class="col-3 col-sm-2 col-lg-1 border text-center">';l+="<strong>"+a.name+'</strong><br><span id="'+e+'dalt">'+displayTruncated(a.level)+"</span>",l+="</div>",$("#daltifacts").append(l)})}function generateSkills(){$("#skills").empty(),$.each(skills.data,function(e,a){isNaN(a.level)&&(a.level=0);var t='<tr class="'+(1==a.active?"":"text-dark bg-secondary")+'" id="skill'+e+'row">';t+="<td>",t+='<input type="checkbox" aria-label="Checkbox to designate active status for '+a.name+'" id="skill'+e+'active"'+(1==a.active?' checked="checked"':"")+" onchange=\"updateActiveSkill('"+e+'\');" tabindex="-1">',t+="</td>",t+="<td>",t+='<label for="skill'+e+'active" id="basic-addonskill'+e+'">',t+='<span class="d-block d-sm-none">'+a.name+"</span>",t+='<span class="d-none d-sm-block">'+a.name+"</span>",t+="</label>",t+="</td>",t+="<td>",t+='<input id="skill'+e+'" value="'+a.level+'" type="tel" class="form-control artlvl" placeholder="0" aria-label="Level of '+a.name+'" aria-describedby="basic-addonskill'+e+'"onchange="updateSkill(\''+e+"')\">",t+="</td>",t+="<td>",t+='<span class="badge" id="skill'+e+'expo"></span>',t+="</td>",t+="<td>",t+='<button class="badge badge-secondary" type="button" data-toggle="collapse" data-target="#skill'+e+'info" aria-expanded="false" aria-controls="skill'+e+'info" tabindex="-1">&#x00A0;i&#x00A0;</button>',t+="</td>",t+="</tr>",t+='<tr class="collapse" id="skill'+e+'info">',t+='<td colspan="5">',t+='<dl class="row">',t+='<dt class="col-3 col-sm-6 text-right">Name</dt>',t+='<dd class="col-9 col-sm-6">'+a.name+"</dd>",t+='<dt class="col-3 col-sm-6 text-right">Effect</dt>',t+='<dd class="col-9 col-sm-6" id="skill'+e+'effect"></dd>',t+='<dt class="col-3 col-sm-6 text-right">Effect2</dt>',t+='<dd class="col-9 col-sm-6" id="skill'+e+'effect2"></dd>',t+='<dt class="col-3 col-sm-6 text-right">Effect3</dt>',t+='<dd class="col-9 col-sm-6" id="skill'+e+'effect3"></dd>',t+='<dt class="col-3 col-sm-6 text-right">',t+='<span class="d-block d-sm-none">Cost</span>',t+='<span class="d-none d-sm-block">Cost to Upgrade</span>',t+="</dt>",t+='<dd class="col-9 col-sm-6" id="skill'+e+'cost"></dd>',t+='<dt class="col-3 col-sm-6 text-right">',t+='<span class="d-block d-sm-none">Effc.</span>',t+='<span class="d-none d-sm-block">Efficiency</span>',t+="</dt>",t+='<dd class="col-9 col-sm-6" id="skill'+e+'eff"></dd>',t+="</dl>",t+="</td>",t+="</tr>",$("#skills").append(t)})}function adjustBoS(){var e=artifacts.data.bos.expo.sum_sort,a=0;$.each(artifacts.data,function(t,l){l.sort<=e&&"bos"!=t&&1==l.active&&(a+=l.rating)}),artifacts.data.bos.rating=a,artifacts=calculate(artifacts,"bos",!0,!0),artifacts.data.boh.rating=a,artifacts=calculate(artifacts,"boh",!0,!0)}function updateActive(e){$("#"+e+"active").is(":checked")?(artifacts.data[e].active=1,$("#"+e+"row").removeClass("text-dark bg-secondary")):(artifacts.data[e].active=0,$("#"+e+"row").addClass("text-dark bg-secondary")),adjustBoS(),artifacts=calculate(artifacts,e,!0,!0)}function updateActiveSkill(e){$("#skill"+e+"active").is(":checked")?(skills.data[e].active=1,$("#skill"+e+"row").removeClass("text-dark bg-secondary")):(skills.data[e].active=0,$("#skill"+e+"row").addClass("text-dark bg-secondary")),calculateAllSkills()}function checkAllArtifacts(){$.each(artifacts.data,function(e,a){$("#"+e+"active").prop("checked",!0),artifacts.data[e].active=1,$("#"+e+"row").removeClass("text-dark bg-secondary"),$("#"+e).prop("readonly",!1)}),artifacts=calculateAll(artifacts,!0)}function checkAllSkills(){$.each(skills.data,function(e,a){$("#skill"+e+"active").prop("checked",!0),skills.data[e].active=1,$("#skill"+e+"row").removeClass("text-dark bg-secondary"),$("#skill"+e).prop("readonly",!1)}),calculateAllSkills()}function resetSkills(){$.each(skills.data,function(e,a){skills.data[e].level=0}),calculateSkillTotals(),calculateAllSkills()}function dalViewArtifact(e){e?$("#dal-tab").tab("show"):$("#artifacts-tab").tab("show")}function regenerateArtifacts(){$.each(artifacts.data,function(e,a){isNaN(a.level)&&(a.level=0),$("#"+e).val(a.level),$("#"+e+"dalt").text(displayTruncated(a.level));var t="";0<a.level&&null!=a.current_effect&&(t=displayEffect(a.current_effect,a.type)),t+=a.bonus,$("#"+e+"effect").empty().append(t),t="",0<a.level&&null!=a.current_ad&&(t=displayPct(a.current_ad)),$("#"+e+"ad").empty().append(t),t="",1==a.active&&null!=a.displayCost&&(t=a.displayCost+" Relics"),$("#"+e+"cost").empty().append(t),t="",1==a.active&&null!=a.efficiency&&""!=a.efficiency&&(t=a.efficiency.toExponential(12)),$("#"+e+"eff").empty().append(t),t="",null!=a.rating&&(t=a.rating.toFixed(2).replace(/\.?0+$/,"")),$("#"+e+"expo").empty().append(t).removeClass().addClass("badge").addClass("badge-"+a.color)}),storeData()}function regenerateSkills(){$.each(skills.data,function(e,a){isNaN(a.level)&&(a.level=0),$("#skill"+e).val(a.level),$("#"+a.nickname).text(a.level);var t=a.bonus_font?a.bonus_font:"";0<a.level&&null!=a.current_effect&&(t+=displayEffect(a.current_effect,a.type)),t+=a.bonus,$("#skill"+e+"effect").empty().append(t);t="";0<a.level&&null!=a.current_effect2&&0!=a.current_effect2&&-1!=a.current_effect2&&(t=displayEffect(a.current_effect2,a.type2)),t+=-1!=a.bonus2?a.bonus2:"",$("#skill"+e+"effect2").empty().append(t);t="";0<a.level&&null!=a.current_effect3&&0!=a.current_effect3&&-1!=a.current_effect3&&(t=displayEffect(a.current_effect3,a.type3)),t+=-1!=a.bonus3?a.bonus3:"",$("#skill"+e+"effect3").empty().append(t),t="",1==a.active&&null!=a.cost&&(t=a.cost+" SP"),$("#skill"+e+"cost").empty().append(t),t="",1==a.active&&null!=a.efficiency&&""!=a.efficiency&&(t=a.efficiency),$("#skill"+e+"eff").empty().append(t),t="",null!=a.rating&&(t=a.rating.toFixed(2).replace(/\.?0+$/,"")),$("#skill"+e+"expo").empty().append(t).removeClass().addClass("badge").addClass("badge-"+("info"==a.color?"success":a.color))}),storeData()}function updateArtifact(e){artifacts.data[e].level=parseInt($("#"+e).val()),artifacts.totalAD=calculateTotalAD(artifacts.data,!0),1==recalc_litmus?adjustWeights():storeData()}function updateSkill(e){var a=parseInt($("#skill"+e).val());skills.data[e].level=skills.data[e].max<a?skills.data[e].max:a,$("#skill"+e).val(a),adjustWeights()}function countArtifacts(e){var a=0;return $.each(e,function(e,t){t.level>0&&a++}),a}function determineAverage(e){var a=countArtifacts(e),t=0,l=0;return $.each(e,function(e,a){obfuscate++,a.level>0&&(t+=a.level)}),a>0&&t>0&&(l=t/a),l}function optimize(){for(;buffer-- >0&&relics>=temp_artifacts.data[winner_e].cost;)obfuscate++,null==upgrades[winner_e]?upgrades[winner_e]=1:upgrades[winner_e]++,relics-=temp_artifacts.data[winner_e].cost,temp_artifacts.data[winner_e].level++,temp_artifacts=calculate(temp_artifacts,winner_e,!1,!1);if(relics>=temp_artifacts.data[winner_e].cost){var e=100*(1-(relics>0?relics/orelics:0/orelics));$("#progress").width(e+"%"),$("#progress").prop("aria-valuenow",e),buffer=obuffer,window.setTimeout(optimize,1)}else{e=100;$("#progress").width(e+"%"),$("#progress").prop("aria-valuenow",e),$("#progress").removeClass("progress-bar-striped progress-bar-animated"),renderSuggestions()}}function generateUpgrades(){switch(0==recalc_litmus&&adjustWeights(),obfuscate=0,white_rabbit=new Date,$("#export_wrap").hide(),$("#import_wrap").hide(),$("#new_artifact").empty(),$("#pudding").empty(),$("#accept").empty(),$("#suggestions").empty(),$("#progressBar").hide(),$("#progress").width("0%"),$("#progress").prop("aria-valuenow",0),$("#progress").addClass("progress-bar-striped progress-bar-animated"),$("#progressBar").show(),$("#relicsuggs").show(),$("#relicreccs").hide(),storeData(),""!=winner_n&&$("#new_artifact").empty().append("<em>注意：你最好积累圣物以挖掘新神器 ("+artifacts.data[winner_n].name+").</em>"),relics=new Decimal((""==$("#relics").val()?0:$("#relics").val())+"."+(""==$("#relics_decimal").val()?0:$("#relics_decimal").val())),buffer=0,$("#relic_factor").val()){case"_":relics=relics.toNumber(),buffer=10;break;case"K":relics=relics.mul(1e3).toNumber(),buffer=100;break;case"M":relics=relics.mul(1e6).toNumber(),buffer=250;break;case"B":relics=relics.mul(1e9).toNumber(),buffer=500;break;case"T":relics=relics.mul(1e12).toNumber(),buffer=750;break;case"e13":relics=relics.mul(1e13).toNumber(),buffer=1e3;break;case"e14":relics=relics.mul(1e14).toNumber(),buffer=2500;break;case"e15":relics=relics.mul(1e15).toNumber(),buffer=5e3;break;case"e16":relics=relics.mul(1e16).toNumber(),buffer=7500;break;case"e17":relics=relics.mul(1e17).toNumber(),buffer=1e4;break;case"e18":relics=relics.mul(1e18).toNumber(),buffer=25e3;break;case"e19":relics=relics.mul(1e19).toNumber(),buffer=5e4;break;case"e20":relics=relics.mul(1e20).toNumber(),buffer=75e3;break;case"e21":relics=relics.mul(1e21).toNumber(),buffer=1e5;break;case"e22":relics=relics.mul(1e22).toNumber(),buffer=125e3;break;case"e23":relics=relics.mul(1e23).toNumber(),buffer=15e4;break;case"e24":relics=relics.mul(1e24).toNumber(),buffer=175e3;break;case"e25":relics=relics.mul(1e25).toNumber(),buffer=25e4;break;case"e26":relics=relics.mul(1e26).toNumber(),buffer=5e5;break;case"e27":relics=relics.mul(1e27).toNumber(),buffer=75e4;break;case"e28":relics=relics.mul(1e28).toNumber(),buffer=1e6;break;case"e29":relics=relics.mul(1e29).toNumber(),buffer=125e4;break;case"e30":relics=relics.mul(1e30).toNumber(),buffer=15e5;break;case"e31":relics=relics.mul(1e31).toNumber(),buffer=175e4;break;case"e32":relics=relics.mul(1e32).toNumber(),buffer=25e5;break;case"e33":relics=relics.mul(1e33).toNumber(),buffer=5e6;break;case"e34":relics=relics.mul(1e34).toNumber(),buffer=75e5;break;case"e35":relics=relics.mul(1e35).toNumber(),buffer=1e7;break;case"e36":relics=relics.mul(1e36).toNumber(),buffer=125e5;break;case"e37":relics=relics.mul(1e37).toNumber(),buffer=25e6;break;case"e38":relics=relics.mul(1e38).toNumber(),buffer=75e6;break;case"e39":relics=relics.mul(1e39).toNumber(),buffer=1e8}orelics=relics,obuffer=buffer,upgrades={},temp_artifacts=$.extend(!0,{},artifacts);var e=!1;$.each(temp_artifacts.data,function(a,t){t.level>0&&(e=!0)}),0!=e?relics>0?optimize():renderSuggestions():$("#suggestions").empty().append("<p>You must have at least 1 artifact enabled to use this.</p>")}function renderSuggestions(){winner_e="",winner_n="";var e=null==$("#ocd").val()?1:$("#ocd").val();1!=e&&$.each(artifacts.data,function(a,t){if(obfuscate++,a in upgrades){var l=Math.floor(temp_artifacts.data[a].level/e)*e;l>artifacts.data[a].level?(temp_artifacts.data[a].level=l,temp_artifacts=calculate(temp_artifacts,a,!1,!1),upgrades[a]=l-artifacts.data[a].level):-1==artifacts.data[a].max&&delete upgrades[a]}});var a="",t=!1;if($.each(upgrades,function(e,a){t=!0}),0==t)return $("#suggestions").empty().append("<p>没有任何对于您的升级建议，请您在有更多的圣物时重试，或降低购买倍数以查看结果</p>"),$("#accept").empty().append('<button type="button" class="btn btn-danger" onclick="rejectSuggestions();">Cancel</button>'),void(relics=0);$.each(artifacts.data,function(e,t){e in upgrades&&(a+='<div class="card border border-secondary '+(1==$("#wolf").prop("checked")?"bg-dark":"")+'">',a+='<div class="card-header d-flex justify-content-between align-items-center" id="'+e+'deetsh">',a+="<span>",a+='<span class="d-inline d-sm-none">'+t.name+"</span>",a+='<span class="d-none d-sm-inline">'+t.name+"</span>",a+=" <small>"+displayTruncated(t.level)+"&#x00A0;=>&#x00A0;"+displayTruncated(temp_artifacts.data[e].level)+"</small>",a+='<span class="badge badge-'+t.color+' ml-3">+'+upgrades[e]+"</span>",a+="</span>",a+='<button class="badge badge-secondary" type="button" data-toggle="collapse" data-target="#'+e+'deets" aria-expanded="false" aria-controls="'+e+'deets">&#x00A0;i&#x00A0;</button>',a+="</div>",a+='<div class="collapse" id="'+e+'deets" aria-labelledby="'+e+'deetsh" data-parent="#suggestions">',a+='<div class="card-body">',a+='<dl class="row">',a+='<dt class="col-3 col-sm-6 text-right">Effect</dt>',a+='<dd class="col-9 col-sm-6">'+displayEffect(artifacts.data[e].current_effect,artifacts.data[e].type)+" => "+displayEffect(temp_artifacts.data[e].current_effect,artifacts.data[e].type)+"</dd>",a+='<dt class="col-3 col-sm-6 text-right">',a+='<span class="d-block d-sm-none">AD</span>',a+='<span class="d-none d-sm-block">Artifact Damage</span>',a+="</dt>",a+='<dd class="col-9 col-sm-6">'+displayPct(artifacts.data[e].current_ad)+" => "+displayPct(temp_artifacts.data[e].current_ad)+"</dd>",a+="</dl>",a+="</div>",a+="</div>",a+="</div>")});var l=(new Date).getTime()-white_rabbit.getTime();$("#pudding").empty().append("共执行计算 "+obfuscate+"次 在 "+(l/1e3).toFixed(3)+"秒内 ("+(obfuscate/l*1e3).toFixed(3)+"/s)"),$("#suggestions").empty().append(a),$("#accept2").show(),$("#accept").empty().append('<button type="button" class="btn btn-primary" onclick="acceptSuggestions();">完成</button><button type="button" class="btn btn-danger" onclick="rejectSuggestions();">取消</button>')}function acceptSuggestions(){gtag("event","Upgrades",{event_category:"Upgrades",event_action:"Accept",event_label:"Artifacts"}),$.each(upgrades,function(e,a){artifacts.data[e].level+=a}),artifacts.totalAD=calculateTotalAD(artifacts.data,!0),$("#new_artifact").empty(),$("#accept").empty(),$("#accept2").hide(),$("#suggestions").empty(),$("#relics").val(""),$("#relics_decimal").val(""),$("#relicsuggs").hide(),$("#relicreccs").show(),adjustWeights()}function rejectSuggestions(){$("#new_artifact").empty(),$("#accept").empty(),$("#accept2").hide(),$("#suggestions").empty(),$("#relics").val(""),$("#relics_decimal").val(""),$("#relicsuggs").hide(),$("#relicreccs").show(),calculateAll(artifacts,!0)}function skillEff(e,a){var t=!1,l=!1,s=!1;0<a.level&&(t=a.levels[a.level].bonus),-1!=a.bonus2&&(l=a.level>0?a.levels[a.level].bonus2:"X"),-1!=a.bonus3&&(s=a.level>0?a.levels[a.level].bonus3:"X"),skills.data[e].current_effect=t,skills.data[e].current_effect2=l,skills.data[e].current_effect3=s;var c=1;if(a.max<a.level&&(a.level=a.max,skills.data[e].level=a.max,$("#skill"+e).val(a.max)),a.max>a.level){!1===t&&(t=0),skills.data[e].cost=a.levels[a.level+1].cost;for(var r=a.level+1;r>0;)a.levels[r--].cost;var i=a.levels[a.level+1].bonus;"aaw"==e&&0<a.level&&(i=Math.pow(i,a.levels[a.level+1].bonus3),t=Math.pow(t,a.levels[a.level].bonus3));var n=Math.abs(i)/(0<a.level&&0!=t&&"X"!=t?Math.abs(t):Math.abs(i/2));if(c*=Math.pow(n,a.rating),!1!==l){var o=a.levels[a.level+1].bonus2;if(0!=o){var d=Math.abs(o)/(0<a.level&&0!=l&&"X"!=l?Math.abs(l):Math.abs(o/2)),f=Math.pow(d,a.rating);"cs"==e||(c*=f)}}if(!1!==s){var p=a.levels[a.level+1].bonus3;if(0!=p){var u=Math.abs(p)/(0<a.level&&0!=s&&"X"!=s?Math.abs(s):Math.abs(p/2));c*=Math.pow(u,a.rating)}}var b=Decimal(c).pow(1/a.levels[a.level+1].cost).sub(1).toNumber();skills.data[e].efficiency=b}}function oldEff(e,a,t){var l=t.level*t.ad,s=1+t.effect*Math.pow(t.level,Math.pow(1+(t.cexpo-1)*Math.min(t.grate*t.level,t.gmax),t.gexpo));if(e.data[a].current_ad=l,e.data[a].current_effect=s,-1==t.max||t.max>t.level){var c=Math.pow(t.level+1,t.cexpo)*t.ccoef;e.data[a].cost=c,e.data[a].displayCost=displayTruncated(c);var r=1+t.effect*Math.pow(t.level+1,Math.pow(1+(t.cexpo-1)*Math.min(t.grate*(t.level+1),t.gmax),t.gexpo)),i=Math.abs(r)/Math.abs(s),n=Math.pow(i,t.rating),o=1+((t.level+1)*t.ad-l)/e.totalAD,d=Math.abs((n*o-1)/c);e.data[a].efficiency=d}return e}function newEff(e,a,t,l,s,c){e.data[a].current_ad="",e.data[a].current_effect="";for(var r=1,i=-1==t.max||t.max>l?l:t.max;r<=i;)s+=Math.pow(r++,t.cexpo)*t.ccoef;if(-1==t.max||t.max>l)var n=1+t.effect*Math.pow(l,Math.pow(1+(t.cexpo-1)*Math.min(t.grate*l,t.gmax),t.gexpo));else n=1+t.effect*Math.pow(t.max,Math.pow(1+(t.cexpo-1)*Math.min(t.grate*t.max,t.gmax),t.gexpo));var o=Math.pow(Math.abs(n),t.rating),d=1+l*t.ad/e.totalAD,f=Math.abs((o*d-1)/s/c);return e.data[a].efficiency=f,e}function calculateTotalAD(e,a){var t=0;return $.each(e,function(e,a){obfuscate++,t+=a.level*a.ad}),1==a&&$("#adsanity").text(displayPct(t*(""!=artifacts.data.hsw.current_effect?artifacts.data.hsw.current_effect:1))),t}function calculateSkillTotals(){skills.totals.SP=0,skills.totals.red=0,skills.totals.yellow=0,skills.totals.blue=0,skills.totals.green=0,$.each(skills.data,function(e,a){if(a.level>a.max&&(a.level=a.max,skills.data[e].level=a.max,$("#skill"+e).val(a.max)),a.level>0)for(var t=1;t<=a.level;){var l=a.levels[t];skills.totals.SP+=l.cost,skills.totals[a.branch]+=l.cost,t++}}),$("#totalSP").text(skills.totals.SP),$("#totalSPred").text(skills.totals.red),$("#totalSPyellow").text(skills.totals.yellow),$("#totalSPblue").text(skills.totals.blue),$("#totalSPgreen").text(skills.totals.green)}function calculate(e,a,t,l){obfuscate++;var s=countArtifacts(artifacts.data)+1,c=artifact_costs[s],r=determineAverage(artifacts.data),i=e.data[a];if(e.data[a].efficiency="",e.data[a].cost="",e.data[a].displayCost="",i.level>0&&1==i.active)i.current_ad,(e=oldEff(e,a,i)).data[a].current_ad;else 0==i.level&&-1!=c&&1==i.active&&!0===l?e=newEff(e,a,i,r,c,Object.keys(artifact_costs).length-3-s):(e.data[a].current_ad="",e.data[a].current_effect="");winner_e="";var n="",o=0;return winner_value=0,$.each(e.data,function(a,t){obfuscate++,t.efficiency>winner_value&&(t.level>0&&1==t.active&&(-1==t.max||t.max>t.level)?(winner_e=a,winner_value=t.efficiency):0==t.level&&-1!=c&&1==t.active&&!0===l&&e.data[a].efficiency>o&&(n=a,o=e.data[a].efficiency))}),!0===t&&(regenerateArtifacts(),winner_n=""!=n&&e.data[n].efficiency>winner_value?n:""),e.totalAD=calculateTotalAD(e.data,t),e}function determineSkillWinner(e){winner_svalue=0;var a="";return $.each(skills.data,function(t,l){if(-1!=e.indexOf(t))return!0;l.efficiency>winner_svalue&&l.max>l.level&&(skills.totals[l.branch]>=tiers[l.tier]&&(-1==l.prereq||0<skills.data[l.prereq].level)?(a=t,winner_svalue=l.efficiency):skills.totals[l.branch]<tiers[l.tier]&&-1==skills.data[l.prereq].prereq&&-1==e.indexOf(l.prereq)?(a=l.prereq,winner_svalue=l.efficiency):skills.totals[l.branch]>=tiers[l.tier]&&-1==skills.data[skills.data[l.prereq].prereq].prereq?0<skills.data[skills.data[l.prereq].prereq].level&&-1==e.indexOf(l.prereq)?(a=l.prereq,winner_svalue=l.efficiency):-1==e.indexOf(skills.data[l.prereq].prereq)&&(a=skills.data[l.prereq].prereq,winner_svalue=l.efficiency):skills.totals[l.branch]>=tiers[l.tier]&&-1==skills.data[skills.data[skills.data[l.prereq].prereq].prereq].prereq&&(0<skills.data[skills.data[skills.data[l.prereq].prereq].prereq].level?0<skills.data[skills.data[l.prereq].prereq].level&&-1==e.indexOf(l.prereq)?(a=l.prereq,winner_svalue=l.efficiency):-1==e.indexOf(skills.data[l.prereq].prereq)&&(a=skills.data[l.prereq].prereq,winner_svalue=l.efficiency):-1==e.indexOf(skills.data[skills.data[l.prereq].prereq].prereq)&&(a=skills.data[skills.data[l.prereq].prereq].prereq,winner_svalue=l.efficiency)))}),a}function calculateAllSkills(){winner_s1="",winner_s2="",winner_s3="",winner_s4="",winner_s5="";var e=[];$.each(skills.data,function(e,a){skills.data[e].efficiency=0,skills.data[e].cost="",1==a.active?skillEff(e,a):(skills.data[e].current_effect="",skills.data[e].current_effect2="",skills.data[e].current_effect3="")}),winner_s1=determineSkillWinner(e),e.push(winner_s1),winner_s2=determineSkillWinner(e),e.push(winner_s2),winner_s3=determineSkillWinner(e),e.push(winner_s3),winner_s4=determineSkillWinner(e),e.push(winner_s4),winner_s5=determineSkillWinner(e),calculateSkillTotals(),regenerateSkills();var a="";""!=winner_s1&&(a+='<button type="button" class="btn btn-primary mb-2 mr-2 col-12 col-md-6 col-xl-4" onclick="acceptSkill(\''+winner_s1+"')\">#1: "+skills.data[winner_s1].name+" "+skills.data[winner_s1].nickname+" ("+skills.data[winner_s1].cost+' SP) <span class="badge ml-2 badge-pill badge-'+("info"==skills.data[winner_s1].color?"success":skills.data[winner_s1].color)+'">'+skills.data[winner_s1].efficiency.toExponential(2)+"</span>"),""!=winner_s2&&(a+='<button type="button" class="btn btn-primary mb-2 mr-2 col-12 col-md-6 col-xl-4" onclick="acceptSkill(\''+winner_s2+"')\">#2: "+skills.data[winner_s2].name+" "+skills.data[winner_s2].nickname+" ("+skills.data[winner_s2].cost+' SP) <span class="badge ml-2 badge-pill badge-'+("info"==skills.data[winner_s2].color?"success":skills.data[winner_s2].color)+'">'+skills.data[winner_s2].efficiency.toExponential(2)+"</span>"),""!=winner_s3&&(a+='<button type="button" class="btn btn-primary mb-2 mr-2 col-12 col-md-6 col-xl-4" onclick="acceptSkill(\''+winner_s3+"')\">#3: "+skills.data[winner_s3].name+" "+skills.data[winner_s3].nickname+" ("+skills.data[winner_s3].cost+' SP) <span class="badge ml-2 badge-pill badge-'+("info"==skills.data[winner_s3].color?"success":skills.data[winner_s3].color)+'">'+skills.data[winner_s3].efficiency.toExponential(2)+"</span></button>"),""!=winner_s4&&(a+='<button type="button" class="btn btn-primary mb-2 mr-2 col-12 col-md-6 col-xl-4" onclick="acceptSkill(\''+winner_s4+"')\">#4: "+skills.data[winner_s4].name+" "+skills.data[winner_s4].nickname+" ("+skills.data[winner_s4].cost+' SP) <span class="badge ml-2 badge-pill badge-'+("info"==skills.data[winner_s4].color?"success":skills.data[winner_s4].color)+'">'+skills.data[winner_s4].efficiency.toExponential(2)+"</span></button>"),""!=winner_s5&&(a+='<button type="button" class="btn btn-primary mb-2 mr-2 col-12 col-md-6 col-xl-4" onclick="acceptSkill(\''+winner_s5+"')\">#5: "+skills.data[winner_s5].name+" "+skills.data[winner_s5].nickname+" ("+skills.data[winner_s5].cost+' SP) <span class="badge ml-2 badge-pill badge-'+("info"==skills.data[winner_s5].color?"success":skills.data[winner_s5].color)+'">'+skills.data[winner_s5].efficiency.toExponential(2)+"</span></button>"),a+="",$("#nextskill").empty().append(a)}function acceptSkill(e){gtag("event","Upgrades",{event_category:"Upgrades",event_action:"Accept",event_label:"SP"}),comeUndone=e,skills.data[e].level++,calculateSkillTotals(),adjustWeights()}function undoSkill(){gtag("event","Upgrades",{event_category:"Upgrades",event_action:"Undo",event_label:"SP"}),""!=comeUndone&&(skills.data[comeUndone].level--,calculateSkillTotals(),adjustWeights(),comeUndone="")}function calculateAll(e,a){winner_e="";var t="",l=0;winner_value=0;var s=countArtifacts(artifacts.data)+1,c=artifact_costs[s],r=determineAverage(artifacts.data);return $.each(e.data,function(a,i){e.data[a].cost="",e.data[a].displayCost="",i.level>0&&1==i.active?(e=oldEff(e,a,i)).data[a].efficiency>winner_value&&(-1==i.max||i.max>i.level)&&(winner_e=a,winner_value=e.data[a].efficiency):0==i.level&&-1!=c&&1==i.active?(e=newEff(e,a,i,r,c,Object.keys(artifact_costs).length-3-s)).data[a].efficiency>winner_value&&e.data[a].efficiency>l&&(t=a,l=e.data[a].efficiency):(e.data[a].current_ad="",e.data[a].current_effect="")}),!0===a&&(regenerateArtifacts(),winner_n=""!=t&&e.data[t].efficiency>winner_value?t:""),e.totalAD=calculateTotalAD(e.data,a),e}function displayPct(e){return(e=displayTruncated(100*e))+"%"}function displayTruncated(e){return e>1e21?(e=(e/1e21).toFixed(2).replace(/\.?0+$/,""),e+="e21/ac"):e>1e20?(e=(e/1e20).toFixed(2).replace(/\.?0+$/,""),e+="e20"):e>1e19?(e=(e/1e19).toFixed(2).replace(/\.?0+$/,""),e+="e19"):e>1e18?(e=(e/1e18).toFixed(2).replace(/\.?0+$/,""),e+="e18/ab"):e>1e17?(e=(e/1e17).toFixed(2).replace(/\.?0+$/,""),e+="e17"):e>1e16?(e=(e/1e16).toFixed(2).replace(/\.?0+$/,""),e+="e16"):e>999999999999999?(e=(e/1e15).toFixed(2).replace(/\.?0+$/,""),e+="e15/aa"):e>99999999999999?(e=(e/1e14).toFixed(2).replace(/\.?0+$/,""),e+="e14"):e>9999999999999?(e=(e/1e13).toFixed(2).replace(/\.?0+$/,""),e+="e13"):e>999999999999?(e=(e/1e12).toFixed(2).replace(/\.?0+$/,""),e+="T"):e>999999999?(e=(e/1e9).toFixed(2).replace(/\.?0+$/,""),e+="B"):e>999999?(e=(e/1e6).toFixed(2).replace(/\.?0+$/,""),e+="M"):e>999?(e=(e/1e3).toFixed(2).replace(/\.?0+$/,""),e+="K"):e=(1*e).toFixed(2).replace(/\.?0+$/,""),e}function displayEffect(e,a){switch(a){case"multiply":return"x"+displayTruncated(e);case"add":return 0!=e&&(e-=1),e>0?"+"+displayTruncated(e):displayTruncated(e);case"add_skill":return e>0?"+"+displayTruncated(e):displayTruncated(e);case"multiply_pct":return"x"+displayPct(e);case"pct":return(e-=1)>0?"+"+displayPct(e):displayPct(e);case"pct_pos":return e>0?"+"+displayPct(e):displayPct(e)}}function storageAvailable(e){try{var a=window[e],t="__storage_test__";return a.setItem(t,t),a.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==a.length}}if(storageAvailable("localStorage")){var localArtifacts=JSON.parse(window.localStorage.getItem("artifacts"));null!=localArtifacts&&void 0===localArtifacts.data&&(localArtifacts.data=jQuery.extend(!0,{},localArtifacts)),null!=localArtifacts&&void 0!==localArtifacts.data&&$.each(localArtifacts.data,function(e,a){null!=artifacts.data[e]&&(artifacts.data[e].level=a.level,artifacts.data[e].active=a.active)}),artifacts.totalAD=calculateTotalAD(artifacts.data,!0);var localSkills=JSON.parse(window.localStorage.getItem("skills"));null!=localSkills&&void 0===localSkills.data&&(localSkills.data=jQuery.extend(!0,{},localSkills)),null!=localSkills&&void 0!==localSkills.data&&$.each(localSkills.data,function(e,a){null!=skills.data[e]&&(skills.data[e].level=a.max<a.level?a.max:a.level,skills.data[e].active=a.active)}),calculateSkillTotals(),$("#build").val(window.localStorage.getItem("build")),$("#hero").val(window.localStorage.getItem("hero")),$("#gold").val(window.localStorage.getItem("gold")),$("#active").val(window.localStorage.getItem("active")),$("#relic_factor").val(window.localStorage.getItem("relic_factor")),$("#ocd").val(window.localStorage.getItem("ocd")),"1"==window.localStorage.getItem("dark")?($("#wolf").prop("checked",!0),$("#lamb").prop("checked",!1)):($("#wolf").prop("checked",!1),$("#lamb").prop("checked",!0)),"1"==window.localStorage.getItem("splash")?($("#wet").prop("checked",!0),$("#dry").prop("checked",!1)):($("#wet").prop("checked",!1),$("#dry").prop("checked",!0)),toggleDark(),toggleSplash(!1)}function storeData(){window.localStorage.setItem("artifacts",JSON.stringify(artifacts)),window.localStorage.setItem("skills",JSON.stringify(skills)),window.localStorage.setItem("build",$("#build").val()),window.localStorage.setItem("hero",$("#hero").val()),window.localStorage.setItem("gold",$("#gold").val()),window.localStorage.setItem("active",$("#active").val()),window.localStorage.setItem("relic_factor",$("#relic_factor").val()),window.localStorage.setItem("ocd",$("#ocd").val()),window.localStorage.setItem("dark",1==$("#wolf").prop("checked")?1:0),window.localStorage.setItem("splash",1==$("#wet").prop("checked")?1:0)}function exportData(){$("#export_wrap").hide(),$("#import_wrap").hide();var e="";e+=$("#build").val()+"=",e+=$("#hero").val()+"=",e+=$("#gold").val()+"=",e+=$("#active").val()+"=",e+=(1==$("#wolf").prop("checked")?1:0)+"=",e+=(1==$("#wet").prop("checked")?1:0)+"=",e+=$("#relic_factor").val()+"=",e+=$("#ocd").val()+"=",$.each(artifacts.data,function(a,t){e+=a+"_",e+=t.active+"_",e+=t.level+"|"}),e=e.slice(0,-1),e+="=",$.each(skills.data,function(a,t){e+=a+"_",e+=t.active+"_",e+=t.level+"|"}),e=e.slice(0,-1),$("#export").empty().text(e),$("#export_wrap").show()}function startImport(){$("#export_wrap").hide(),$("#import_wrap").hide(),$("#import").empty(),$("#import_wrap").show()}function importData(){var e=$("#import").val().trim().split("=");$("#build").val(e[0]),$("#hero").val(e[1]),$("#gold").val(e[2]),$("#active").val(e[3]),"1"==e[4]?($("#wolf").prop("checked",!0),$("#lamb").prop("checked",!1)):($("#wolf").prop("checked",!1),$("#lamb").prop("checked",!0)),toggleDark(),"1"==e[5]?($("#wet").prop("checked",!0),$("#dry").prop("checked",!1)):($("#wet").prop("checked",!1),$("#dry").prop("checked",!0)),toggleSplash(!1),$("#relic_factor").val(e[6]),$("#ocd").val(e[7]);var a=e[8].split("|");$.each(a,function(e,a){var t=a.split("_");artifacts.data[t[0]].active=parseInt(t[1]),artifacts.data[t[0]].level=parseInt(t[2])});var t=e[9].split("|");$.each(t,function(e,a){var t=a.split("_");skills.data[t[0]].active=parseInt(t[1]),skills.data[t[0]].level=parseInt(t[2])}),$("#export_wrap").hide(),$("#import_wrap").hide(),generateArtifacts(),generateSkills(),adjustWeights()}$('input[type="tel"]').on("focus",function(){$(this).data("fontSize",$(this).css("font-size")).css("font-size","16px")}).on("blur",function(){$(this).css("font-size",$(this).data("fontSize"))}),$("#export_wrap").hide(),$("#import_wrap").hide(),$("#relicsuggs").hide(),generateArtifacts(),generateSkills(),0==halp&&adjustWeights();